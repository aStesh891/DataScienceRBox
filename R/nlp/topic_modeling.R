# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
install.packages(c("text2vec", "tm", "ggplot2", "reshape2"))
library(text2vec)
library(tm)
library(ggplot2)
library(reshape2)


# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—à–∫–∏ —Å–ª–æ–≤
bags <- list(
  "–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞" = c(
    "–∫–≤–∞–Ω—Ç", "–º–µ—Ö–∞–Ω–∏–∫–∞", "—á–∞—Å—Ç–∏—Ü–∞", "–≤–æ–ª–Ω–∞", "—Å—É–ø–µ—Ä–ø–æ–∑–∏—Ü–∏—è", "–∑–∞–ø—É—Ç–∞–Ω–Ω–æ—Å—Ç—å",
    "—Å–ø–∏–Ω", "–±–æ–∑–æ–Ω", "—Ñ–µ—Ä–º–∏–æ–Ω", "–Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å", "–≥–µ–π–∑–µ–Ω–±–µ—Ä–≥", "–æ—Ä–±–∏—Ç–∞–ª—å",
    "—Å–ø–µ–∫—Ç—Ä", "–ø–æ–≥–ª–æ—â–µ–Ω–∏–µ", "–∏–∑–ª—É—á–µ–Ω–∏–µ", "—Ç—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ", "–ø–æ–ª–µ", "—Ä–µ–∑–æ–Ω–∞–Ω—Å",
    "—Ñ–æ—Ç–æ–Ω", "–º–∞—Å—Å–∞", "—ç–Ω–µ—Ä–≥–∏—è", "–∏–∑–º–µ—Ä–µ–Ω–∏–µ", "–∞—Ç–æ–º", "–º–æ–ª–µ–∫—É–ª–∞", "–ø—Ä–æ—Ç–æ–Ω",
    "–Ω–µ–π—Ç—Ä–æ–Ω", "—ç–ª–µ–∫—Ç—Ä–æ–Ω", "–¥–≤–æ–π–Ω–æ–π", "—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç", "–∫–æ–ª–ª–∞–ø—Å", "–≤–æ–ª–Ω–æ–≤–∞—è",
    "—Ñ—É–Ω–∫—Ü–∏—è", "–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å", "–∏–Ω—Ç–µ—Ä—Ñ–µ—Ä–µ–Ω—Ü–∏—è", "–¥–∏—Ñ—Ä–∞–∫—Ü–∏—è", "–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å",
    "–æ–ø–µ—Ä–∞—Ç–æ—Ä", "–º–∞—Ç—Ä–∏—Ü–∞", "—ç–Ω—Ç—Ä–æ–ø–∏—è", "–±–æ–∑–µ-—ç–π–Ω—à—Ç–µ–π–Ω", "–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç",
    "–±–æ–∑–æ–Ω", "—Ö–∏–≥–≥—Å–∞", "–∫–æ—Å–º–æ–ª–æ–≥–∏—è", "—Ç–µ–º–Ω–∞—è", "–º–∞—Ç–µ—Ä–∏—è", "–∞–Ω–Ω–∏–≥–∏–ª—è—Ü–∏—è",
    "–∫–∞–ª–∏–±—Ä–æ–≤–∫–∞", "—Å–∏–º–º–µ—Ç—Ä–∏—è", "—Å–ø–æ–Ω—Ç–∞–Ω–Ω–∞—è"
  ),
  "–†—ã–Ω–æ–∫ –ø—à–µ–Ω–∏—Ü—ã" = c(
    "–ø—à–µ–Ω–∏—Ü–∞", "–∑–µ—Ä–Ω–æ", "—É—Ä–æ–∂–∞–π", "—Ñ–µ—Ä–º–µ—Ä", "–∞–≥—Ä–æ–Ω–æ–º", "–ø–æ—Å–µ–≤", "–∑–∞—Å—É—Ö–∞",
    "–≤–ª–∞–∂–Ω–æ—Å—Ç—å", "—É–¥–æ–±—Ä–µ–Ω–∏–µ", "–≥–µ—Ä–±–∏—Ü–∏–¥", "—Ü–µ–Ω–∞", "–±–∏—Ä–∂–∞", "–∫–æ–Ω—Ç—Ä–∞–∫—Ç",
    "—ç–∫—Å–ø–æ—Ä—Ç", "–∏–º–ø–æ—Ä—Ç", "—Å–ø—Ä–æ—Å", "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ", "—Ç—Ä–µ–π–¥–µ—Ä", "–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ",
    "–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞", "—ç–ª–µ–≤–∞—Ç–æ—Ä", "–º–µ–ª—å–Ω–∏—Ü–∞", "–≥–ª—é—Ç–µ–Ω", "–±–µ–ª–æ–∫", "–∫–∞—á–µ—Å—Ç–≤–æ",
    "—Å–æ—Ä—Ç–∞", "–∫–ª–∏–º–∞—Ç", "–ª–æ–≥–∏—Å—Ç–∏–∫–∞", "–¥–æ—Å—Ç–∞–≤–∫–∞", "—Å—É–±—Å–∏–¥–∏–∏", "–∫–≤–æ—Ç–∞",
    "–Ω–∞–ª–æ–≥", "—Å—Ç–æ–∏–º–æ—Å—Ç—å", "—É—Ä–æ–∂–∞–π–Ω–æ—Å—Ç—å", "–º–µ—Ö–∞–Ω–∏–∑–∞—Ü–∏—è", "—Ç–µ—Ö–Ω–∏–∫–∞",
    "–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è", "–±–∏–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å", "—Ç–æ—Ä–≥–æ–≤–ª—è",
    "–±–∏—Ä–∂–µ–≤–∞—è", "–∫–æ—Ç–∏—Ä–æ–≤–∫–∞", "–¥–æ–ª–ª–∞—Ä", "–µ–≤—Ä–æ", "–ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ",
    "–∞–Ω–∞–ª–∏—Ç–∏–∫–∞"
  ),
  "–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö 1" = c(
    "–¥–∞–Ω–Ω—ã–µ", "–∞–ª–≥–æ—Ä–∏—Ç–º", "–º–æ–¥–µ–ª—å", "–º–∞—à–∏–Ω–Ω–æ–µ", "–æ–±—É—á–µ–Ω–∏–µ", "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
    "–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è", "—Ä–µ–≥—Ä–µ—Å—Å–∏—è", "–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è", "–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è",
    "–∞–Ω–æ–º–∞–ª–∏—è", "–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è", "–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ", "–ø—Ä–æ–≥–Ω–æ–∑", "–æ–±—Ä–∞–±–æ—Ç–∫–∞",
    "—Å–±–æ—Ä", "–æ—á–∏—Å—Ç–∫–∞", "–≤—ã–±—Ä–æ—Å—ã", "—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ", "–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å",
    "–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞", "–º–µ–¥–∏–∞–Ω–∞", "—Å—Ä–µ–¥–Ω–µ–µ", "–º–æ–¥–∞", "—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ",
    "–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ", "–±–∞–π–µ—Å", "–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è", "overfitting", "underfitting",
    "—Ä–µ—à–∞—é—â–µ–µ", "–¥–µ—Ä–µ–≤–æ", "–Ω–µ–π—Ä–æ–Ω–Ω–∞—è", "—Å–µ—Ç—å", "–≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π", "–±—É—Å—Ç–∏–Ω–≥",
    "pca", "big data", "sql", "—Ö—Ä–∞–Ω–∏–ª–∏—â–µ", "–∞–Ω–∞–ª–∏—Ç–∏–∫–∞", "–¥–∞—à–±–æ—Ä–¥",
    "–∫–ª–∞—Å—Ç–µ—Ä", "api"
  ),
  "–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö 2" = c(
    "feature engineering", "–Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö", "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π", "—Ç–µ—Å—Ç–æ–≤—ã–π",
    "–Ω–µ–π—Ä–æ—Å–µ—Ç—å", "–≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Å–ø—É—Å–∫", "—Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å", "–º–µ—Ç—Ä–∏–∫–∞", 
    "—Ç–æ—á–Ω–æ—Å—Ç—å", "recall", "f1-score", "auc-roc", "–∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è",
    "–±—É—Å—Ç–∏–Ω–≥", "—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ", "–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤", "pipeline",
    "–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞", "—à—É–º", "–ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ", "–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤",
    "—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è", "–æ–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö", "–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å",
    "shapley values", "tensorflow", "pytorch", "rnn", "cnn",
    "—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä", "–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä", "adam", "sgd", "momentum",
    "–æ–±—É—á–µ–Ω–∏–µ –±–µ–∑ —É—á–∏—Ç–µ–ª—è", "—Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", "—ç–º–±–µ–¥–¥–∏–Ω–≥–∏",
    "n-gram", "–∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ", "word2vec", "fasttext",
    "bert", "gpt", "h2o", "spark", "kafka"
  )
)


corpus <- VCorpus(VectorSource(bags))

# –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
corpus <- tm_map(corpus, content_transformer(tolower))
corpus <- tm_map(corpus, removePunctuation)
corpus <- tm_map(corpus, removeWords, stopwords("russian"))
corpus <- tm_map(corpus, stripWhitespace)

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã "–¥–æ–∫—É–º–µ–Ω—Ç-—Ç–µ—Ä–º"
dtm <- DocumentTermMatrix(corpus)
dtm_matrix <- as.matrix(dtm)

# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –µ–¥–∏–Ω–∏—á–Ω–æ–π –¥–ª–∏–Ω–µ)
normalized_dtm <- dtm_matrix / sqrt(rowSums(dtm_matrix^2))


# –§—É–Ω–∫—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫–∏ –ì–æ–≤–µ—Ä–∞
hoover_metric <- function(v1, v2) {
  return(sum(abs(v1 - v2)) / sum(v1 + v2))
}

hoover_1_4 <- hoover_metric(bags$`–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞`, bags$`–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö 2`)


# –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
hoover_values <- data.frame(
  Comparison = c("–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞ vs –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö", 
                 "—ã–Ω–æ–∫ –∑–µ—Ä–Ω–∞ vs –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö", 
                 "–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö (1)  vs –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö (2)"),
  HooverMetric = c(hoover_1_4, hoover_2_4, hoover_3_4)
)

# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å—Ç–æ–ª–±—á–∞—Ç–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
ggplot(hoover_values, aes(x = Comparison, y = HooverMetric, fill = Comparison)) +
  geom_bar(stat = "identity", color = "black", width = 0.6) +
  scale_fill_manual(values = c("blue", "red", "green")) +  # –¶–≤–µ—Ç–∞ —Å—Ç–æ–ª–±—Ü–æ–≤
  theme_minimal() +
  labs(title = "–ú–µ—Ç—Ä–∏–∫–∞ –ì–æ–≤–µ—Ä–∞ –º–µ–∂–¥—É —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –≥—Ä—É–ø–ø–∞–º–∏",
       x = "–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º—ã–µ –≥—Ä—É–ø–ø—ã",
       y = "–ú–µ—Ç—Ä–∏–∫–∞ –ì–æ–≤–µ—Ä–∞") +
  theme(axis.text.x = element_text(angle = 15, hjust = 1)) +
  geom_text(aes(label = round(HooverMetric, 3)), vjust = -0.5, size = 5)  # –ü–æ–¥–ø–∏—Å–∏ –∑–Ω–∞—á–µ–Ω–∏–π



corpus <- VCorpus(VectorSource(bags))

# –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
corpus <- tm_map(corpus, content_transformer(tolower))
corpus <- tm_map(corpus, removePunctuation)
corpus <- tm_map(corpus, removeWords, stopwords("russian"))
corpus <- tm_map(corpus, stripWhitespace)

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã "–¥–æ–∫—É–º–µ–Ω—Ç-—Ç–µ—Ä–º"
dtm <- DocumentTermMatrix(corpus)
dtm_matrix <- as.matrix(dtm)

# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –µ–¥–∏–Ω–∏—á–Ω–æ–π –¥–ª–∏–Ω–µ)
normalized_dtm <- dtm_matrix / sqrt(rowSums(dtm_matrix^2))

# –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
# –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –î–æ–∫—É–º–µ–Ω—Ç—ã 1 –∏ 2 –∏–º–µ—é—Ç —Å—Ö–æ–¥—Å—Ç–≤–æ 0.583, 
#   –∑–Ω–∞—á–∏—Ç, –æ–Ω–∏ –ª–µ–∫—Å–∏—á–µ—Å–∫–∏ –ø–æ—Ö–æ–∂–∏, –Ω–æ –Ω–µ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã.
similarity <- crossprod(normalized_dtm)
similarity

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Ç—Ä–∏—Ü—É —Å—Ö–æ–¥—Å—Ç–≤–∞ –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è ggplot2
sim_data <- as.data.frame(as.table(similarity))
colnames(sim_data) <- c("Document1", "Document2", "Similarity")

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –Ω–æ–º–µ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ —Ñ–∞–∫—Ç–æ—Ä—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
sim_data$Document1 <- as.factor(sim_data$Document1)
sim_data$Document2 <- as.factor(sim_data$Document2)

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
ggplot(sim_data, aes(x = Document1, y = Document2, fill = Similarity)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "blue") +
  theme_minimal() +
  labs(title = "–õ–µ–∫—Å–∏—á–µ—Å–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤", x = "–î–æ–∫—É–º–µ–Ω—Ç 1", y = "–î–æ–∫—É–º–µ–Ω—Ç 2")

#################################################################
### –ó–∞–¥–∞—á–∞ 2: –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (LDA + –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ)

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
library(topicmodels)
library(ggplot2)
library(reshape2)
library(tibble)  # –î–æ–±–∞–≤–ª—è–µ–º –¥–ª—è rownames_to_column()

# –û–±—É—á–µ–Ω–∏–µ LDA (2 —Ç–µ–º—ã)
lda_model <- LDA(dtm, k = 2, control = list(seed = 123))

# –ü–æ–ª—É—á–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º
topic_distributions <- posterior(lda_model)$topics

# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (–µ–¥–∏–Ω–∏—á–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–µ–∫—Ç–æ—Ä–∞)
normalized_topics <- topic_distributions / sqrt(rowSums(topic_distributions^2))

# –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
# –î–æ–∫—É–º–µ–Ω—Ç—ã –∏–º–µ—é—Ç –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞:
#   –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö (–∞–Ω–∞–ª–∏–∑, –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
#   –†–∞–±–æ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–∞–º–∏ (–∏–∑—É—á–∞—Ç—å, –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–º–æ–≥–∞–µ—Ç, —Ç–µ–∫—Å—Ç—ã, —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ)
similarity_topics <- crossprod(normalized_topics)

# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è ggplot2
sim_topics_data <- as.data.frame(similarity_topics) %>%
  rownames_to_column(var = "Document1") %>%
  melt(id.vars = "Document1", variable.name = "Document2", value.name = "Similarity")

# –§–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–æ–º–µ—Ä–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
sim_topics_data$Document1 <- as.factor(sim_topics_data$Document1)
sim_topics_data$Document2 <- as.factor(sim_topics_data$Document2)

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞
ggplot(sim_topics_data, aes(x = Document1, y = Document2, fill = Similarity)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "green") +
  theme_minimal() +
  labs(title = "–¢–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤", x = "–î–æ–∫—É–º–µ–Ω—Ç 1", y = "–î–æ–∫—É–º–µ–Ω—Ç 2")











# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ DataFrame
bags_df <- stack(bags)
colnames(bags_df) <- c("Word", "Topic")


### –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–ª–æ–≤ —Å GloVe

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ GloVe
glove_model <- text2vec::read.wordvectors("glove.6B.50d.txt", type = "txt")

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–∞ —Å–ª–æ–≤–∞
get_word_vector <- function(word, model) {
  if (word %in% rownames(model)) {
    return(model[word, ])
  } else {
    return(rep(0, ncol(model)))  # –ï—Å–ª–∏ —Å–ª–æ–≤–∞ –Ω–µ—Ç –≤ –º–æ–¥–µ–ª–∏, –≤–µ—Ä–Ω—É—Ç—å –Ω—É–ª–µ–≤–æ–π –≤–µ–∫—Ç–æ—Ä
  }
}

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–ª–æ–≤–∞ –≤ –≤–µ–∫—Ç–æ—Ä—ã
word_vectors <- t(sapply(bags_df$Word, get_word_vector, model = glove_model))

# –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–º–µ
word_vectors_df <- as.data.frame(word_vectors)
word_vectors_df$Topic <- bags_df$Topic


### –ê–Ω–∞–ª–∏–∑ —Å—Ö–æ–¥—Å—Ç–≤–∞ —Ç–µ–º

# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤
normalize_vector <- function(vec) {
  return(vec / sqrt(sum(vec^2)))
}
normalized_vectors <- t(apply(word_vectors, 1, normalize_vector))

# –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞
similarity_matrix <- crossprod(normalized_vectors)

# –°–æ–∑–¥–∞–Ω–∏–µ DataFrame –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
similarity_df <- as.data.frame(similarity_matrix)
rownames(similarity_df) <- bags_df$Word
colnames(similarity_df) <- bags_df$Word

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ö–æ–¥—Å—Ç–≤–∞ —Ç–µ–º
# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –¥–ª–∏–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
sim_long <- melt(similarity_df)
colnames(sim_long) <- c("Word1", "Word2", "Similarity")

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
ggplot(sim_long, aes(x = Word1, y = Word2, fill = Similarity)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "red") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "–ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ —Å–ª–æ–≤ –≤ —Ç–µ–º–∞—Ö", x = "–°–ª–æ–≤–æ 1", y = "–°–ª–æ–≤–æ 2")






# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
install.packages(c("text2vec", "slam"))
library(text2vec)
library(slam)

# üîπ –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –•–µ–ª–ª–∏–Ω–≥–µ—Ä–∞
hellinger_distance <- function(p, q) {
  sqrt(0.5 * sum((sqrt(p) - sqrt(q))^2))
}

# üîπ –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –º–µ—à–∫–æ–≤ —Å–ª–æ–≤ (bag-of-words)
prepare_bow <- function(texts, vocab = NULL) {
  it <- itoken(texts, progressbar = FALSE)
  vectorizer <- vocab_vectorizer(vocab)
  dtm <- create_dtm(it, vectorizer)
  dtm <- normalize(dtm, margin = 1)  # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π
  return(as.matrix(dtm))
}

# üîπ –ò—Å—Ö–æ–¥–Ω—ã–µ –º–µ—à–∫–∏ —Å–ª–æ–≤
bag1 <- c("–∫–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞ –≤–æ–ª–Ω—ã —á–∞—Å—Ç–∏—Ü—ã —ç–Ω–µ—Ä–≥–∏—è —Å—É–ø–µ—Ä–ø–æ–∑–∏—Ü–∏—è")
bag2 <- c("—Ä—ã–Ω–æ–∫ –ø—à–µ–Ω–∏—Ü—ã —Å–ø—Ä–æ—Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç –∏–º–ø–æ—Ä—Ç —Ü–µ–Ω—ã")
bag3 <- c("–∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º—ã")
bag4 <- c("–∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏")

# –°–æ–∑–¥–∞–µ–º —Å–ª–æ–≤–∞—Ä—å –∏–∑ –≤—Å–µ—Ö –º–µ—à–∫–æ–≤
all_texts <- c(bag1, bag2, bag3, bag4)
vocab <- create_vocabulary(itoken(all_texts, progressbar = FALSE))
vocab <- prune_vocabulary(vocab, term_count_min = 1)

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º DTM (–º–∞—Ç—Ä–∏—Ü—É –º–µ—à–∫–æ–≤ —Å–ª–æ–≤)
dtm_bags <- prepare_bow(c(bag1, bag2, bag3, bag4), vocab)

# üîπ –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –•–µ–ª–ª–∏–Ω–≥–µ—Ä–∞ –º–µ–∂–¥—É –º–µ—à–∫–∞–º–∏
hellinger_matrix <- matrix(0, nrow = 4, ncol = 4)

for (i in 1:4) {
  for (j in 1:4) {
    hellinger_matrix[i, j] <- hellinger_distance(dtm_bags[i, ], dtm_bags[j, ])
  }
}

# üîπ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
heatmap(hellinger_matrix, main = "Hellinger Distance Between Bags", col = heat.colors(10))




library(text2vec)
library(tm)
library(ggplot2)
library(reshape2)
library(data.table)

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—à–∫–∏ —Å–ª–æ–≤
bags <- list(
  "–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞" = c("–∫–≤–∞–Ω—Ç", "–º–µ—Ö–∞–Ω–∏–∫–∞", "—á–∞—Å—Ç–∏—Ü–∞", "–≤–æ–ª–Ω–∞"),
  "–†—ã–Ω–æ–∫ –ø—à–µ–Ω–∏—Ü—ã" = c("–ø—à–µ–Ω–∏—Ü–∞", "–∑–µ—Ä–Ω–æ", "—É—Ä–æ–∂–∞–π", "—Ñ–µ—Ä–º–µ—Ä"),
  "–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö 1" = c("–¥–∞–Ω–Ω—ã–µ", "–∞–ª–≥–æ—Ä–∏—Ç–º", "–º–æ–¥–µ–ª—å", "–º–∞—à–∏–Ω–Ω–æ–µ"),
  "–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö 2" = c("feature engineering", "–Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö", "–æ–±—É—á–µ–Ω–∏–µ")
)

# –°–æ–∑–¥–∞–µ–º –∫–æ—Ä–ø—É—Å —Ç–µ–∫—Å—Ç–æ–≤
corpus <- Corpus(VectorSource(unlist(bags)))

# –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
corpus <- tm_map(corpus, content_transformer(tolower))
corpus <- tm_map(corpus, removePunctuation)
corpus <- tm_map(corpus, removeWords, stopwords("russian"))
corpus <- tm_map(corpus, stripWhitespace)

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã "–¥–æ–∫—É–º–µ–Ω—Ç-—Ç–µ—Ä–º"
dtm <- DocumentTermMatrix(corpus)
dtm_matrix <- as.matrix(dtm)

# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
normalized_dtm <- dtm_matrix / sqrt(rowSums(dtm_matrix^2))

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ DataFrame
bags_df <- stack(bags)
colnames(bags_df) <- c("Word", "Topic")

# === –ó–∞–≥—Ä—É–∑–∫–∞ GloVe ===
glove_path <- "glove.6B.50d.txt"  # –ü—Ä–æ–≤–µ—Ä—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
glove_model <- fread(glove_path, header = FALSE, quote = "", stringsAsFactors = FALSE)

# –†–∞–∑–¥–µ–ª—è–µ–º –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ –∏ –≤–µ–∫—Ç–æ—Ä
rownames(glove_model) <- glove_model$V1
glove_model$V1 <- NULL
glove_matrix <- as.matrix(glove_model)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–∞ —Å–ª–æ–≤–∞
get_word_vector <- function(word, model) {
  if (word %in% rownames(model)) {
    return(model[word, ])
  } else {
    return(rep(0, ncol(model)))
  }
}

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–ª–æ–≤–∞ –≤ –≤–µ–∫—Ç–æ—Ä—ã
word_vectors <- t(sapply(bags_df$Word, get_word_vector, model = glove_matrix))

print(word_vectors)






